#include(*) $lng/activity.edf.lng
[Title]=SCRIPT DEL USUARIO|l
[DBTable]{$_ENV['SYSDB']}gs_activity
[DBIndex]cd_gs_user,cdi
[DBOrder]1 desc
[DBAddFilter]edes='F' and cdi_ftp is null
[DBGroupBy]2
[MaxRec]0
[FormAction]*|edes.php?Ll:
[ColsOp]C
[Format]
if( $_vF[1][0]=='$' ) $_CellsStyle[1] = 'color:#ff00ff;font-weight:bold';
if( $_vF[1]=='/_datos/config/sql.log' ){
$GLOBALS['_LogDB'] = true;
$_CellsStyle[1] = 'color:red;font-weight:bold';
}
if( $_vF[1]=='/_datos/config/directory.log' ){
$GLOBALS['_LogDIR'] = true;
$_CellsStyle[1] = 'color:red;font-weight:bold';
}
if( $_vF[1]=='/_datos/config/update.log' ){
$GLOBALS['_LogScript'] = true;
$_CellsStyle[1] = 'color:red;font-weight:bold';
}
if( mb_substr_count($_vF[1],'/tree/')>0 ) $_CellsStyle[1] = 'color:green;font-weight:bold';
if( $_vF[2] > 1 ) $_CellsStyle[2] = 'background:#FFB5B5;font-weight:bold';
[PDFCol],,0,0
[TipTH]@Ultima fecha de grabación@|@Nombre del Script@|@Anular la actualización@|@Actualizar por HTTP@|@Nº Desarrolladores por script@
[Fields]
#(?) @CDI@|cdi|CDI|T|19||MQ|||
#!(?) @CDI@|max(cdi)|CDI|T|19||MQ|||
@Script@|script|#|T|70||MQ|||
@Desarrolladores@|'' as dev|N|T|50||-|||
[PHPStart]l
if( $_dia!='' ) $_DBADDFILTER = '';
$_xAnd = (( $_DBADDFILTER!='' ) ? ' and ' : '' );
SS::query("select count(distinct cd_gs_user) from {$_ENV['SYSDB']}gs_activity where {$_DBADDFILTER}{$_xAnd} cd_gs_user={$_GET['cd_gs_user']} and cdi>='{$_dia} 00:00:00' and cdi<='{$_dia} 23:59:59'");
list( $GLOBALS['TotalDesarrolladores'] ) = SS::get("num");
[JSEnd]l
var TABLA = S("#BROWSE").obj;
TABLA.rows[TABLA.rows.length-1].cells[2].textContent = '<?= $TotalDesarrolladores ?>';
TABLA.rows[TABLA.rows.length-1].cells[2]..title = '@Total nº Desarrolladores distintos@';
[DBSql]l
$_TReg = SS::count("{$_ENV['SYSDB']}gs_activity", $_DBADDFILTER.$_xAnd.' cd_gs_user='.$_GET['cd_gs_user']." and cdi>='{$_dia} 00:00:00' and cdi<='{$_dia} 23:59:59'");
if( $_TReg > 0 ){
$DimScriptPorUser = array();
$usuCursor = array();
$DimUser = array();
SS::query( "select max(cdi),script, '' from {$_ENV['SYSDB']}gs_activity as a where ".$_DBADDFILTER.$_xAnd.' cd_gs_user='.$_GET['cd_gs_user']." and cdi>='{$_dia} 00:00:00' and cdi<='{$_dia} 23:59:59'".' group by 2 order by 1' );
while( $r=SS::get("num") ){
$script = trim($r[1]);
$nUsu = '';
SS::query( "select distinct cd_gs_user from {$_ENV['SYSDB']}gs_activity where script='{$script}' and ".$_DBADDFILTER.$_xAnd.' cd_gs_user='.$_GET['cd_gs_user']." and cdi>='{$_dia} 00:00:00' and cdi<='{$_dia} 23:59:59'", [], 1);
while( $u=SS::get("num", 1) ){
$DimUser[$u[0]] = 1;
if( $nUsu!='' ) $nUsu .= ',';
$nUsu .= $u[0];
$DimScriptPorUser[$u[0]]++;
}
$r[2] = $nUsu;
$usuCursor[] = $r;
}
$Usuarios = '';
foreach( $DimUser as $k=>$v ) $Usuarios .= ','.$k;
if( $Usuarios[0]==',' ) $Usuarios = mb_substr($Usuarios,1);
if( $Usuarios!='' ){
SS::query( "select cd_gs_user, user_name from {$_ENV['SYSDB']}gs_user where cd_gs_user in ( {$Usuarios} )" );
while( $u=SS::get("num") ) $DimUser[$u[0]] = trim($u[1]);
for( $n=0; $n<count($usuCursor); $n++ ){
$tmp = explode(',',$usuCursor[$n][2]);
$usuCursor[$n][2] = '';
for( $i=0; $i<count($tmp); $i++ ){
if( $usuCursor[$n][2]!='' ) $usuCursor[$n][2] .= ', ';
$usuCursor[$n][2] .= $DimUser[$tmp[$i]];
}
}
}
}
[OnLoad]l|BROWSE.rows[0].cells[1].style.width=BROWSE.rows[0].cells[1].offsetWidth; document.ondblclick=null;
[JSOnClickRow]l
if( ColNumber==2 ){
top.eSWOpen( window, 'Ll:$a/u/activity_df&_FILTER='+escape('script="'+eTrim(_oTR.cells[1].innerHTML)+'"'), '', false );
}else{
top.gsEdit(window, BROWSE.rows[RowNumber].cells[1].textContent );
}